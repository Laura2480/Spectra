<div>
    <h2>{{ "stepper.upload.interview_file" | translate }}</h2>
    <div *ngIf="files.length === 0 && (selectedClinician == null || selectedPatient == null)"
        class="d-flex align-items-center">
        <div class="bg-warning p-2 mb-2 rounded text-gray">
            <div class="d-flex align-items-center">
                <mat-icon class="info-icon" aria-hidden="false" aria-label="Info" fontIcon="info"></mat-icon>
                <div class="mx-1">Attenzione: Selezionare almeno un medico e un paziente.
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="files.length === 0" class="row mt-3">
        <div class="col-md-6">
            <ng-select [items]="patients" bindLabel="fullName" bindValue="id" placeholder="Seleziona un paziente"
                [(ngModel)]="selectedPatient">
            </ng-select>
        </div>
        <div class="col-md-6">
            <ng-select [items]="doctors" bindLabel="fullName" bindValue="_id" placeholder="Seleziona un medico"
                [(ngModel)]="selectedClinician">
            </ng-select>
        </div>
    </div>
    <div *ngIf="files.length === 0 && selectedClinician != null && selectedPatient != null" class="upload-dropzone"
        (drop)="onDrop($event)" (dragover)="onDragOver($event)">
        <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-upload"
                viewBox="0 0 16 16">
                <path
                    d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5" />
                <path
                    d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z" />
            </svg>
        </div>
        <p class="upload-instructions">
            {{ "stepper.upload.description" | translate }}
        </p>
        <p class="upload-details">
            {{ "stepper.upload.informative" | translate }}
        </p>
        <button type="button" class="btn btn-primary btn-primary-color" (click)="selezionaFile(fileInput)">
            {{ "stepper.buttons.select_file.label" | translate }}
        </button>
        <input #fileInput type="file" multiple (change)="onFileSelected($event)" style="display: none;" />
    </div>

    <div class="upload-filelist mb-3" *ngIf="files.length > 0">
        <div *ngFor="let file of files; index as i">
            {{ file.name }} ({{ (file.size * 1024 / 1048576) / 1000 | number:'1.2-2' }} MB)
            <mat-icon style="font-size: 19px; line-height: 38px;" class="pointer" color="warn"
                (click)="sendRemoveFile(i)">close</mat-icon>
            <span class="progress">{{progress}}%</span>
            <mat-progress-bar mode="determinate" [value]="progress"></mat-progress-bar>
        </div>
    </div>

    <div *ngIf="files.length > 0">
        <div class="mb-3" *ngIf="files.length > 0">
            <h4 class="mb-0"> {{ "stepper.upload.estimate_time" | translate }}{{ (estimatedTime / 60) | number:'1.0-0'
                }} min</h4>
            <div style="height: 30px;">
                <mat-progress-bar mode="determinate" [value]="getEstimatedTimePercent(estimatedTime)"
                    class="estimated-time-bar" [ngStyle]="{'--bar-color': getEstimatedTimeColor(estimatedTime / 60)}">
                </mat-progress-bar>
            </div>
        </div>
        <div class="mb-3">
            <h4 class="mb-0">{{ "stepper.upload.estimate_accuracy" | translate }}{{ accuracy | number:'1.2-2' }}%</h4>
            <mat-progress-bar mode="determinate" [value]="accuracy" class="accuracy-bar custom-progress"
                [ngStyle]="{'--bar-color': getAccuracyColor(accuracy)}">
            </mat-progress-bar>

        </div>
    </div>
</div>